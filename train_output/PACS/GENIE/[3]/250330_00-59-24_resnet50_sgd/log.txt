[37m[36mINFO[0m[0m 03/30 00:59:24 | Command :: /jsm0707/GENIE/train_all.py resnet50_sgd config/resnet50_sgd.yaml --algorithm GENIE --test_envs 3 --dataset PACS
Environment:
	Python: 3.8.10
	PyTorch: 1.13.1+cu117
	Torchvision: 0.14.1+cu117
	CUDA: 11.7
	CUDNN: 8500
	NumPy: 1.22.4
	PIL: 9.4.0
Args:
	algorithm: GENIE
	attn_tune: False
	auto_lr: False
	checkpoint_freq: None
	configs: ['config/resnet50_sgd.yaml']
	data_dir: data
	dataset: PACS
	debug: False
	deterministic: True
	dump_scores: False
	dump_similarities: False
	evalmode: all
	evaluate: False
	full_data: False
	holdout_fraction: 0.2
	hparams_seed: 0
	in_domain: False
	model_save: None
	mpa: False
	name: resnet50_sgd
	out_dir: train_output/PACS/GENIE/[3]/250330_00-59-24_resnet50_sgd
	out_root: train_output/PACS/GENIE/[3]
	prebuild_loader: False
	resume_path: checkpoints/
	seed: 0
	show: False
	small_bs: False
	steps: None
	tb_freq: 10
	test_envs: [3]
	trial_seed: 0
	unique_name: 250330_00-59-24_resnet50_sgd
	warmup: False
	work_dir: .
HParams:
	data_augmentation: True
	val_augment: False
	resnet18: False
	linear_steps: -1
	resnet_dropout: 0.0
	class_balanced: False
	optimizer: sgd
	freeze_bn: False
	pretrained: True
	lr: 5e-05
	batch_size: 32
	weight_decay: 0.0
	momentum: 0.9
	convergence_rate: 0.015
	moving_avg: 0.95
	p: 0.4
	swad: False
	test_batchsize: 128
	model: resnet50
	feat_layers: stem_block
	attn_tune: False
	auto_lr: False
Dataset:
	[PACS] #envs=4, #classes=7
	env0: A (#2048)
	env1: C (#2344)
	env2: P (#1670)
	env3: S (#3929)

[37m[36mINFO[0m[0m 03/30 00:59:24 | n_steps = 5001
[37m[36mINFO[0m[0m 03/30 00:59:24 | checkpoint_freq = 200
[37m[36mINFO[0m[0m 03/30 00:59:24 | n_steps is updated to 5001 => 5001 for checkpointing
[37m[36mINFO[0m[0m 03/30 00:59:24 | 
[37m[36mINFO[0m[0m 03/30 00:59:24 | Testenv name escaping te_S -> te_S
[37m[36mINFO[0m[0m 03/30 00:59:24 | Test envs = [3], name = te_S
[37m[36mINFO[0m[0m 03/30 00:59:24 | Train environments: [0, 1, 2], Test environments: [3]
[37m[36mINFO[0m[0m 03/30 00:59:24 | Batch sizes for each domain: [32, 32, 32, 0] (total=96)
[37m[36mINFO[0m[0m 03/30 00:59:24 | steps-per-epoch for each domain: 51.22, 58.62, 41.75 -> min = 41.75
[37m[36mINFO[0m[0m 03/30 00:59:25 | # of params = 23522375
[37m[36mINFO[0m[0m 03/30 00:59:25 | Extracting features BEFORE training...
[37m[36mINFO[0m[0m 03/30 01:00:03 | test_in     test_out    train_in    train_out   tr_outloss  env0_in     env0_out    env1_in     env1_out    env2_in     env2_out    env3_in     env3_out    step        epoch       loss        step_time   eval_time  
[37m[36mINFO[0m[0m 03/30 01:00:03 | 0.060751    0.063694    0.321419    0.300709    1.846104    0.275168    0.261614    0.272921    0.239316    0.416168    0.401198    0.060751    0.063694    0           0.000000    1.999146    7.059792    30.812232  
[37m[36mINFO[0m[0m 03/30 01:01:43 | 0.661260    0.644586    0.964299    0.947116    0.152850    0.956681    0.931540    0.946695    0.933761    0.989521    0.976048    0.661260    0.644586    200         4.790419    0.280850    0.225172    33.112376  
[37m[36mINFO[0m[0m 03/30 01:03:21 | 0.712468    0.681529    0.981672    0.955545    0.145887    0.979256    0.938875    0.971748    0.948718    0.994012    0.979042    0.712468    0.681529    400         9.580838    0.078387    0.224998    32.138110  
[37m[36mINFO[0m[0m 03/30 01:04:58 | 0.699427    0.699363    0.991676    0.958356    0.147375    0.987187    0.941320    0.989339    0.948718    0.998503    0.985030    0.699427    0.699363    600         14.371257   0.051005    0.222323    31.538211  
[37m[36mINFO[0m[0m 03/30 01:06:38 | 0.721374    0.738854    0.989617    0.959944    0.120103    0.986577    0.948655    0.992004    0.955128    0.990269    0.976048    0.721374    0.738854    800         19.161677   0.032502    0.223598    33.755438  
[37m[36mINFO[0m[0m 03/30 01:08:17 | 0.760814    0.759236    0.995106    0.971572    0.109616    0.992678    0.960880    0.994136    0.965812    0.998503    0.988024    0.760814    0.759236    1000        23.952096   0.017537    0.225727    32.736207  
[37m[36mINFO[0m[0m 03/30 01:09:55 | 0.694020    0.703185    0.993476    0.960451    0.124423    0.990238    0.943765    0.990938    0.961538    0.999251    0.976048    0.694020    0.703185    1200        28.742515   0.019152    0.225967    31.087228  
[37m[36mINFO[0m[0m 03/30 01:11:31 | 0.748728    0.746497    0.995395    0.967356    0.109906    0.994509    0.948655    0.994670    0.959402    0.997006    0.994012    0.748728    0.746497    1400        33.532934   0.016136    0.222717    30.236016  
[37m[36mINFO[0m[0m 03/30 01:13:08 | 0.772901    0.759236    0.998633    0.972711    0.101241    0.998780    0.960880    0.997868    0.972222    0.999251    0.985030    0.772901    0.759236    1600        38.323353   0.011511    0.223473    31.271757  
[37m[36mINFO[0m[0m 03/30 01:14:47 | 0.746183    0.732484    0.997384    0.975625    0.104714    0.996949    0.965770    0.995203    0.970085    1.000000    0.991018    0.746183    0.732484    1800        43.113772   0.009069    0.224123    32.549397  
[37m[36mINFO[0m[0m 03/30 01:16:26 | 0.744911    0.724841    0.994581    0.967821    0.147001    0.992068    0.946210    0.994670    0.972222    0.997006    0.985030    0.744911    0.724841    2000        47.904192   0.013140    0.226749    32.348828  
[37m[36mINFO[0m[0m 03/30 01:18:03 | 0.760814    0.766879    0.994192    0.965905    0.135981    0.992068    0.941320    0.992004    0.974359    0.998503    0.982036    0.760814    0.766879    2200        52.694611   0.008219    0.222940    31.854439  
[37m[36mINFO[0m[0m 03/30 01:19:40 | 0.731234    0.752866    0.998988    0.967886    0.118468    0.998780    0.951100    0.998934    0.961538    0.999251    0.991018    0.731234    0.752866    2400        57.485030   0.010334    0.223869    31.156039  
[37m[36mINFO[0m[0m 03/30 01:21:19 | 0.746501    0.765605    0.999441    0.966624    0.146057    0.999390    0.958435    0.998934    0.959402    1.000000    0.982036    0.746501    0.765605    2600        62.275449   0.004982    0.230928    31.195136  
[37m[36mINFO[0m[0m 03/30 01:23:00 | 0.757634    0.763057    0.996292    0.970471    0.136140    0.996339    0.958435    0.992537    0.967949    1.000000    0.985030    0.757634    0.763057    2800        67.065868   0.007018    0.232904    33.108245  
[37m[36mINFO[0m[0m 03/30 01:24:41 | 0.766539    0.766879    0.998424    0.972101    0.112420    0.996339    0.963325    0.998934    0.967949    1.000000    0.985030    0.766539    0.766879    3000        71.856287   0.007147    0.232538    33.137939  
[37m[36mINFO[0m[0m 03/30 01:26:22 | 0.800573    0.796178    0.997616    0.969656    0.137790    0.995729    0.955990    0.997868    0.967949    0.999251    0.985030    0.800573    0.796178    3200        76.646707   0.005503    0.235013    32.470794  
[37m[36mINFO[0m[0m 03/30 01:28:04 | 0.763995    0.784713    0.999619    0.972570    0.127360    0.999390    0.960880    0.999467    0.965812    1.000000    0.991018    0.763995    0.784713    3400        81.437126   0.006064    0.237135    33.401426  
[37m[36mINFO[0m[0m 03/30 01:29:43 | 0.761450    0.765605    0.999323    0.970433    0.122653    1.000000    0.960880    0.999467    0.959402    0.998503    0.991018    0.761450    0.765605    3600        86.227545   0.003848    0.233979    30.891930  
[37m[36mINFO[0m[0m 03/30 01:31:22 | 0.798346    0.811465    0.999390    0.971778    0.115384    0.998170    0.965770    1.000000    0.961538    1.000000    0.988024    0.798346    0.811465    3800        91.017964   0.003637    0.233630    31.332110  
[37m[36mINFO[0m[0m 03/30 01:33:01 | 0.820929    0.819108    0.998252    0.969862    0.152456    0.998170    0.960880    0.997335    0.963675    0.999251    0.985030    0.820929    0.819108    4000        95.808383   0.004524    0.233155    31.209069  
[37m[36mINFO[0m[0m 03/30 01:34:43 | 0.724873    0.747771    0.997799    0.962000    0.184277    0.997559    0.953545    0.997335    0.959402    0.998503    0.973054    0.724873    0.747771    4200        100.598802  0.003698    0.237798    33.182468  
[37m[36mINFO[0m[0m 03/30 01:36:23 | 0.767494    0.768153    0.996432    0.965626    0.152722    0.996339    0.958435    0.995203    0.959402    0.997754    0.979042    0.767494    0.768153    4400        105.389222  0.002297    0.231050    32.698960  
[37m[36mINFO[0m[0m 03/30 01:38:04 | 0.739504    0.747771    0.999212    0.968658    0.134977    0.998170    0.955990    0.999467    0.967949    1.000000    0.982036    0.739504    0.747771    4600        110.179641  0.004043    0.234232    31.945519  
[37m[36mINFO[0m[0m 03/30 01:39:45 | 0.784033    0.792357    0.999822    0.969290    0.154503    1.000000    0.960880    0.999467    0.967949    1.000000    0.979042    0.784033    0.792357    4800        114.970060  0.003551    0.236552    33.072006  
[37m[36mINFO[0m[0m 03/30 01:41:26 | 0.749046    0.764331    0.999060    0.971492    0.120403    0.998780    0.965770    0.998401    0.963675    1.000000    0.985030    0.749046    0.764331    5000        119.760479  0.003512    0.237666    31.934232  
[37m[36mINFO[0m[0m 03/30 01:41:47 | Extracting features AFTER training...
[37m[36mINFO[0m[0m 03/30 01:41:54 | Feature representations saved to disk.
[37m[36mINFO[0m[0m 03/30 01:41:54 | Cumulative gradient change saved at train_output/PACS/GENIE/[3]/250330_00-59-24_resnet50_sgd/sum_cumulative_g_change.npy
[37m[36mINFO[0m[0m 03/30 01:41:56 | ---
[37m[36mINFO[0m[0m 03/30 01:41:56 | test-domain validation(oracle) = 82.093%
[37m[36mINFO[0m[0m 03/30 01:41:56 | training-domain validation(iid) = 74.618%
[37m[36mINFO[0m[0m 03/30 01:41:56 | last = 74.905%
[37m[36mINFO[0m[0m 03/30 01:41:56 | last (inD) = 97.149%
[37m[36mINFO[0m[0m 03/30 01:41:56 | training-domain validation (iid, inD) = 97.562%
[37m[36mINFO[0m[0m 03/30 01:41:56 | === Summary ===
[37m[36mINFO[0m[0m 03/30 01:41:56 | Command: /jsm0707/GENIE/train_all.py resnet50_sgd config/resnet50_sgd.yaml --algorithm GENIE --test_envs 3 --dataset PACS
[37m[36mINFO[0m[0m 03/30 01:41:56 | Unique name: 250330_00-59-24_resnet50_sgd
[37m[36mINFO[0m[0m 03/30 01:41:56 | Out path: train_output/PACS/GENIE/[3]/250330_00-59-24_resnet50_sgd
[37m[36mINFO[0m[0m 03/30 01:41:56 | Algorithm: GENIE
[37m[36mINFO[0m[0m 03/30 01:41:56 | Dataset: PACS
