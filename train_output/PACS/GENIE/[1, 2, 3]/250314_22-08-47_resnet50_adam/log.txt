[37m[36mINFO[0m[0m 03/14 22:08:47 | Command :: /jsm0707/GENIE/train_all.py resnet50_adam config/resnet50_adam.yaml --algorithm GENIE --test_envs 1 2 3 --dataset PACS
Environment:
	Python: 3.8.10
	PyTorch: 1.13.1+cu117
	Torchvision: 0.14.1+cu117
	CUDA: 11.7
	CUDNN: 8500
	NumPy: 1.24.4
	PIL: 10.4.0
Args:
	algorithm: GENIE
	attn_tune: False
	auto_lr: False
	checkpoint_freq: None
	configs: ['config/resnet50_adam.yaml']
	data_dir: data
	dataset: PACS
	debug: False
	deterministic: True
	dump_scores: False
	dump_similarities: False
	evalmode: all
	evaluate: False
	full_data: False
	holdout_fraction: 0.2
	hparams_seed: 0
	in_domain: False
	model_save: None
	mpa: False
	name: resnet50_adam
	out_dir: train_output/PACS/GENIE/[1, 2, 3]/250314_22-08-47_resnet50_adam
	out_root: train_output/PACS/GENIE/[1, 2, 3]
	prebuild_loader: False
	resume_path: checkpoints/
	seed: 0
	show: False
	small_bs: False
	steps: None
	tb_freq: 10
	test_envs: [1, 2, 3]
	trial_seed: 0
	unique_name: 250314_22-08-47_resnet50_adam
	warmup: False
	work_dir: .
HParams:
	data_augmentation: True
	val_augment: False
	resnet18: False
	linear_steps: -1
	resnet_dropout: 0.0
	class_balanced: False
	optimizer: adam
	freeze_bn: False
	pretrained: True
	lr: 5e-05
	batch_size: 32
	weight_decay: 0.0
	momentum: 0.9
	convergence_rate: 0.015
	moving_avg: 0.95
	p: 0.4
	swad: False
	swad_kwargs: 
	  n_converge: 3
	  n_tolerance: 6
	  tolerance_ratio: 0.3
	test_batchsize: 128
	model: resnet50
	feat_layers: stem_block
	ld: 0.1
	lr_mult: 10.0
	attn_tune: False
	auto_lr: False
Dataset:
	[PACS] #envs=4, #classes=7
	env0: A (#2048)
	env1: C (#2344)
	env2: P (#1670)
	env3: S (#3929)

[37m[36mINFO[0m[0m 03/14 22:08:47 | n_steps = 5001
[37m[36mINFO[0m[0m 03/14 22:08:47 | checkpoint_freq = 200
[37m[36mINFO[0m[0m 03/14 22:08:47 | n_steps is updated to 5001 => 5001 for checkpointing
[37m[36mINFO[0m[0m 03/14 22:08:47 | 
[37m[36mINFO[0m[0m 03/14 22:08:47 | Testenv name escaping te_C_P_S -> te_C_P_S
[37m[36mINFO[0m[0m 03/14 22:08:47 | Test envs = [1, 2, 3], name = te_C_P_S
[37m[36mINFO[0m[0m 03/14 22:08:47 | Train environments: [0], Test environments: [1, 2, 3]
[37m[36mINFO[0m[0m 03/14 22:08:47 | Batch sizes for each domain: [32, 0, 0, 0] (total=32)
[37m[36mINFO[0m[0m 03/14 22:08:47 | steps-per-epoch for each domain: 51.22 -> min = 51.22
[37m[36mINFO[0m[0m 03/14 22:08:48 | # of params = 23522375
[37m[36mINFO[0m[0m 03/14 22:09:12 | test_in     test_out    train_in    train_out   tr_outloss  env0_in     env0_out    env1_in     env1_out    env2_in     env2_out    env3_in     env3_out    step        epoch       loss        step_time   eval_time  
[37m[36mINFO[0m[0m 03/14 22:09:12 | 0.154015    0.144678    0.214155    0.190709    1.884768    0.214155    0.190709    0.166844    0.141026    0.116766    0.119760    0.178435    0.173248    0           0.000000    2.096475    0.980302    22.898742  
[37m[36mINFO[0m[0m 03/14 22:10:32 | 0.732974    0.735071    0.942038    0.914425    0.242894    0.942038    0.914425    0.675373    0.679487    0.951347    0.946108    0.572201    0.579618    200         3.904820    0.387511    0.283605    23.218020  
[37m[36mINFO[0m[0m 03/14 22:11:43 | 0.672890    0.670267    0.937157    0.875306    0.369232    0.937157    0.875306    0.554904    0.534188    0.928144    0.907186    0.535623    0.569427    400         7.809640    0.191830    0.238079    23.290465  
[37m[36mINFO[0m[0m 03/14 22:12:38 | 0.744914    0.746599    0.978035    0.933985    0.201862    0.978035    0.933985    0.624733    0.632479    0.957335    0.955090    0.652672    0.652229    600         11.714460   0.099512    0.150407    24.914701  
[37m[36mINFO[0m[0m 03/14 22:13:50 | 0.737705    0.730477    0.982916    0.936430    0.254990    0.982916    0.936430    0.610874    0.619658    0.941617    0.913174    0.660623    0.658599    800         15.619280   0.051179    0.243999    23.694122  
[37m[36mINFO[0m[0m 03/14 22:15:15 | 0.684351    0.678125    0.934106    0.858191    0.502531    0.934106    0.858191    0.574094    0.561966    0.931886    0.913174    0.547074    0.559236    1000        19.524100   0.060589    0.297184    25.074770  
[37m[36mINFO[0m[0m 03/14 22:16:32 | 0.734533    0.724252    0.989628    0.958435    0.210660    0.989628    0.958435    0.640725    0.634615    0.937874    0.901198    0.625000    0.636943    1200        23.428920   0.022949    0.269696    23.445489  
[37m[36mINFO[0m[0m 03/14 22:17:38 | 0.736142    0.736651    0.960952    0.897311    0.368962    0.960952    0.897311    0.618870    0.630342    0.958832    0.940120    0.630725    0.639490    1400        27.333740   0.035116    0.214830    22.722408  
[37m[36mINFO[0m[0m 03/14 22:18:40 | 0.724960    0.724653    0.978035    0.936430    0.277379    0.978035    0.936430    0.642857    0.649573    0.950599    0.937126    0.581425    0.587261    1600        31.238560   0.042073    0.187844    24.314913  
[37m[36mINFO[0m[0m 03/14 22:19:57 | 0.777684    0.760365    0.995119    0.943765    0.267624    0.995119    0.943765    0.674307    0.673077    0.953593    0.934132    0.705153    0.673885    1800        35.143380   0.030346    0.265888    23.987752  
[37m[36mINFO[0m[0m 03/14 22:21:21 | 0.781425    0.784701    0.998170    0.946210    0.233614    0.998170    0.946210    0.695629    0.705128    0.975299    0.961078    0.673346    0.687898    2000        39.048200   0.019176    0.295430    24.431948  
[37m[36mINFO[0m[0m 03/14 22:22:38 | 0.759640    0.755476    0.991458    0.916870    0.377143    0.991458    0.916870    0.693497    0.707265    0.958832    0.931138    0.626590    0.628025    2200        42.953020   0.014246    0.262636    24.916668  
[37m[36mINFO[0m[0m 03/14 22:23:43 | 0.767672    0.776440    0.997559    0.958435    0.173877    0.997559    0.958435    0.671642    0.677350    0.964072    0.964072    0.667303    0.687898    2400        46.857840   0.014376    0.198797    24.641182  
[37m[36mINFO[0m[0m 03/14 22:24:42 | 0.732851    0.720410    0.998780    0.943765    0.222112    0.998780    0.943765    0.602878    0.587607    0.955090    0.934132    0.640585    0.639490    2600        50.762660   0.015060    0.180434    23.215037  
[37m[36mINFO[0m[0m 03/14 22:25:58 | 0.750594    0.742466    0.994509    0.938875    0.284344    0.994509    0.938875    0.637527    0.649573    0.958084    0.928144    0.656170    0.649682    2800        54.667480   0.014822    0.267127    22.879497  
[37m[36mINFO[0m[0m 03/14 22:27:20 | 0.760889    0.755968    0.998170    0.946210    0.270231    0.998170    0.946210    0.677505    0.668803    0.961078    0.934132    0.644084    0.664968    3000        58.572300   0.010411    0.286828    24.075528  
[37m[36mINFO[0m[0m 03/14 22:28:31 | 0.787863    0.798211    0.997559    0.960880    0.155167    0.997559    0.960880    0.731876    0.741453    0.966317    0.955090    0.665394    0.698089    3200        62.477120   0.010886    0.240388    23.645461  
[37m[36mINFO[0m[0m 03/14 22:29:26 | 0.781969    0.782856    0.997559    0.951100    0.256826    0.997559    0.951100    0.711087    0.709402    0.970060    0.955090    0.664758    0.684076    3400        66.381940   0.014940    0.151976    24.284265  
[37m[36mINFO[0m[0m 03/14 22:30:36 | 0.779621    0.777089    1.000000    0.963325    0.178464    1.000000    0.963325    0.732409    0.726496    0.963323    0.955090    0.643130    0.649682    3600        70.286760   0.020522    0.232807    23.317942  
[37m[36mINFO[0m[0m 03/14 22:31:59 | 0.781091    0.772448    0.997559    0.933985    0.249292    0.997559    0.933985    0.689765    0.700855    0.961078    0.931138    0.692430    0.685350    3800        74.191580   0.016542    0.293640    23.966318  
[37m[36mINFO[0m[0m 03/14 22:33:19 | 0.719622    0.713184    0.999390    0.946210    0.260159    0.999390    0.946210    0.646055    0.641026    0.960329    0.943114    0.552481    0.555414    4000        78.096400   0.009464    0.278787    24.187519  
[37m[36mINFO[0m[0m 03/14 22:34:26 | 0.750044    0.759003    0.999390    0.953545    0.244734    0.999390    0.953545    0.650320    0.664530    0.967814    0.964072    0.631997    0.648408    4200        82.001220   0.002438    0.224957    22.942371  
[37m[36mINFO[0m[0m 03/14 22:35:24 | 0.763752    0.766147    0.998780    0.951100    0.239996    0.998780    0.951100    0.704691    0.709402    0.968563    0.952096    0.618003    0.636943    4400        85.906040   0.008039    0.167156    24.035051  
[37m[36mINFO[0m[0m 03/14 22:36:42 | 0.728807    0.730953    0.997559    0.933985    0.254591    0.997559    0.933985    0.600213    0.613248    0.951347    0.940120    0.634860    0.639490    4600        89.810860   0.006972    0.263553    25.041857  
[37m[36mINFO[0m[0m 03/14 22:38:05 | 0.752840    0.752602    1.000000    0.960880    0.179829    1.000000    0.960880    0.658316    0.666667    0.964072    0.949102    0.636132    0.642038    4800        93.715680   0.008569    0.296856    23.678869  
[37m[36mINFO[0m[0m 03/14 22:39:18 | 0.754423    0.745435    0.991458    0.951100    0.273919    0.991458    0.951100    0.659382    0.641026    0.948353    0.934132    0.655534    0.661146    5000        97.620500   0.007889    0.248491    23.603416  
[37m[36mINFO[0m[0m 03/14 22:39:18 | Cumulative gradient change saved at train_output/PACS/GENIE/[1, 2, 3]/250314_22-08-47_resnet50_adam/sum_cumulative_g_change.npy
[37m[36mINFO[0m[0m 03/14 22:39:20 | ---
[37m[36mINFO[0m[0m 03/14 22:39:20 | test-domain validation(oracle) = 78.786%
[37m[36mINFO[0m[0m 03/14 22:39:20 | training-domain validation(iid) = 77.962%
[37m[36mINFO[0m[0m 03/14 22:39:20 | last = 75.442%
[37m[36mINFO[0m[0m 03/14 22:39:20 | last (inD) = 95.110%
[37m[36mINFO[0m[0m 03/14 22:39:20 | training-domain validation (iid, inD) = 96.333%
[37m[36mINFO[0m[0m 03/14 22:39:20 | === Summary ===
[37m[36mINFO[0m[0m 03/14 22:39:20 | Command: /jsm0707/GENIE/train_all.py resnet50_adam config/resnet50_adam.yaml --algorithm GENIE --test_envs 1 2 3 --dataset PACS
[37m[36mINFO[0m[0m 03/14 22:39:20 | Unique name: 250314_22-08-47_resnet50_adam
[37m[36mINFO[0m[0m 03/14 22:39:20 | Out path: train_output/PACS/GENIE/[1, 2, 3]/250314_22-08-47_resnet50_adam
[37m[36mINFO[0m[0m 03/14 22:39:20 | Algorithm: GENIE
[37m[36mINFO[0m[0m 03/14 22:39:20 | Dataset: PACS
