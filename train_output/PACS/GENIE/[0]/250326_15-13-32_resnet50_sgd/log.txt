[37m[36mINFO[0m[0m 03/26 15:13:32 | Command :: /jsm0707/GENIE/train_all.py resnet50_sgd config/resnet50_sgd.yaml --algorithm GENIE --test_envs 0 --dataset PACS
Environment:
	Python: 3.8.10
	PyTorch: 1.13.1+cu117
	Torchvision: 0.14.1+cu117
	CUDA: 11.7
	CUDNN: 8500
	NumPy: 1.22.4
	PIL: 9.4.0
Args:
	algorithm: GENIE
	attn_tune: False
	auto_lr: False
	checkpoint_freq: None
	configs: ['config/resnet50_sgd.yaml']
	data_dir: data
	dataset: PACS
	debug: False
	deterministic: True
	dump_scores: False
	dump_similarities: False
	evalmode: all
	evaluate: False
	full_data: False
	holdout_fraction: 0.2
	hparams_seed: 0
	in_domain: False
	model_save: None
	mpa: False
	name: resnet50_sgd
	out_dir: train_output/PACS/GENIE/[0]/250326_15-13-32_resnet50_sgd
	out_root: train_output/PACS/GENIE/[0]
	prebuild_loader: False
	resume_path: checkpoints/
	seed: 0
	show: False
	small_bs: False
	steps: None
	tb_freq: 10
	test_envs: [0]
	trial_seed: 0
	unique_name: 250326_15-13-32_resnet50_sgd
	warmup: False
	work_dir: .
HParams:
	data_augmentation: True
	val_augment: False
	resnet18: False
	linear_steps: -1
	resnet_dropout: 0.0
	class_balanced: False
	optimizer: sgd
	freeze_bn: False
	pretrained: True
	lr: 5e-05
	batch_size: 32
	weight_decay: 0.0
	momentum: 0.9
	convergence_rate: 0.015
	moving_avg: 0.95
	p: 0.4
	swad: False
	test_batchsize: 128
	model: resnet50
	feat_layers: stem_block
	attn_tune: False
	auto_lr: False
Dataset:
	[PACS] #envs=4, #classes=7
	env0: A (#2048)
	env1: C (#2344)
	env2: P (#1670)
	env3: S (#3929)

[37m[36mINFO[0m[0m 03/26 15:13:32 | n_steps = 5001
[37m[36mINFO[0m[0m 03/26 15:13:32 | checkpoint_freq = 200
[37m[36mINFO[0m[0m 03/26 15:13:32 | n_steps is updated to 5001 => 5001 for checkpointing
[37m[36mINFO[0m[0m 03/26 15:13:32 | 
[37m[36mINFO[0m[0m 03/26 15:13:32 | Testenv name escaping te_A -> te_A
[37m[36mINFO[0m[0m 03/26 15:13:32 | Test envs = [0], name = te_A
[37m[36mINFO[0m[0m 03/26 15:13:32 | Train environments: [1, 2, 3], Test environments: [0]
[37m[36mINFO[0m[0m 03/26 15:13:32 | Batch sizes for each domain: [0, 32, 32, 32] (total=96)
[37m[36mINFO[0m[0m 03/26 15:13:32 | steps-per-epoch for each domain: 58.62, 41.75, 98.25 -> min = 41.75
[37m[36mINFO[0m[0m 03/26 15:13:33 | # of params = 23522375
[37m[36mINFO[0m[0m 03/26 15:13:33 | Extracting features BEFORE training...
[37m[36mINFO[0m[0m 03/26 15:14:08 | test_in     test_out    train_in    train_out   tr_outloss  env0_in     env0_out    env1_in     env1_out    env2_in     env2_out    env3_in     env3_out    step        epoch       loss        step_time   eval_time  
[37m[36mINFO[0m[0m 03/26 15:14:08 | 0.212935    0.217604    0.268379    0.262549    1.862266    0.212935    0.217604    0.246802    0.290598    0.365269    0.326347    0.193066    0.170701    0           0.000000    1.997718    3.674036    31.442521  
[37m[36mINFO[0m[0m 03/26 15:16:06 | 0.827944    0.831296    0.962794    0.957547    0.119476    0.827944    0.831296    0.955757    0.955128    0.994012    0.985030    0.938613    0.932484    200         4.790419    0.336387    0.439509    29.789253  
[37m[36mINFO[0m[0m 03/26 15:18:02 | 0.791946    0.784841    0.972628    0.959074    0.120754    0.791946    0.784841    0.965352    0.950855    0.991018    0.976048    0.961514    0.950318    400         9.580838    0.094201    0.428054    30.825734  
[37m[36mINFO[0m[0m 03/26 15:19:56 | 0.818182    0.833741    0.979184    0.957264    0.118080    0.818182    0.833741    0.980810    0.961538    1.000000    0.979042    0.956743    0.931210    600         14.371257   0.063168    0.423815    29.299789  
[37m[36mINFO[0m[0m 03/26 15:21:51 | 0.871263    0.875306    0.989334    0.976008    0.098190    0.871263    0.875306    0.987740    0.976496    0.997754    0.991018    0.982506    0.960510    800         19.161677   0.051940    0.423566    29.946797  
[37m[36mINFO[0m[0m 03/26 15:23:47 | 0.863941    0.875306    0.992982    0.970315    0.104830    0.863941    0.875306    0.989872    0.972222    0.999251    0.982036    0.989822    0.956688    1000        23.952096   0.025968    0.422691    31.479577  
[37m[36mINFO[0m[0m 03/26 15:25:42 | 0.865772    0.865526    0.995819    0.967905    0.114726    0.865772    0.865526    0.996269    0.970085    0.998503    0.982036    0.992684    0.951592    1200        28.742515   0.021897    0.429691    29.444938  
[37m[36mINFO[0m[0m 03/26 15:27:38 | 0.869433    0.887531    0.995252    0.973435    0.098885    0.869433    0.887531    0.993070    0.967949    1.000000    0.988024    0.992684    0.964331    1400        33.532934   0.018063    0.423808    31.226383  
[37m[36mINFO[0m[0m 03/26 15:29:36 | 0.847468    0.858191    0.992988    0.972164    0.145161    0.847468    0.858191    0.993070    0.976496    0.999251    0.982036    0.986641    0.957962    1600        38.323353   0.011608    0.431150    31.962087  
[37m[36mINFO[0m[0m 03/26 15:31:33 | 0.848688    0.848411    0.998547    0.976569    0.111471    0.848688    0.848411    0.998934    0.974359    0.999251    0.991018    0.997455    0.964331    1800        43.113772   0.014591    0.425885    30.949013  
[37m[36mINFO[0m[0m 03/26 15:33:30 | 0.843197    0.845966    0.997730    0.977984    0.097208    0.843197    0.845966    0.998934    0.980769    0.997754    0.985030    0.996501    0.968153    2000        47.904192   0.012512    0.436211    30.113948  
[37m[36mINFO[0m[0m 03/26 15:35:26 | 0.832825    0.838631    0.996745    0.973425    0.106644    0.832825    0.838631    0.997868    0.970085    1.000000    0.982036    0.992366    0.968153    2200        52.694611   0.011034    0.425864    31.150474  
[37m[36mINFO[0m[0m 03/26 15:37:22 | 0.869433    0.872861    0.995931    0.970339    0.119611    0.869433    0.872861    0.997335    0.976496    1.000000    0.988024    0.990458    0.946497    2400        57.485030   0.010476    0.422458    30.782620  
[37m[36mINFO[0m[0m 03/26 15:39:19 | 0.863331    0.882641    0.997982    0.969030    0.108515    0.863331    0.882641    0.999467    0.970085    0.999251    0.979042    0.995229    0.957962    2600        62.275449   0.014597    0.431920    30.600402  
[37m[36mINFO[0m[0m 03/26 15:41:16 | 0.858450    0.875306    0.999470    0.974709    0.114008    0.858450    0.875306    1.000000    0.967949    1.000000    0.988024    0.998410    0.968153    2800        67.065868   0.007077    0.420686    33.009836  
[37m[36mINFO[0m[0m 03/26 15:43:11 | 0.871873    0.885086    0.998444    0.978121    0.107431    0.871873    0.885086    0.999467    0.978632    1.000000    0.985030    0.995865    0.970701    3000        71.856287   0.007005    0.423920    30.252435  
[37m[36mINFO[0m[0m 03/26 15:45:06 | 0.868822    0.875306    0.998868    0.975010    0.106678    0.868822    0.875306    0.999467    0.976496    1.000000    0.988024    0.997137    0.960510    3200        76.646707   0.006299    0.422003    30.668204  
[37m[36mINFO[0m[0m 03/26 15:46:24 | 0.833435    0.831296    0.989373    0.960811    0.168791    0.833435    0.831296    0.993603    0.965812    0.995509    0.979042    0.979008    0.937580    3400        81.437126   0.006399    0.225715    33.437568  
[37m[36mINFO[0m[0m 03/26 15:47:41 | 0.814521    0.806846    0.997515    0.962187    0.146114    0.814521    0.806846    0.997335    0.957265    0.997754    0.970060    0.997455    0.959236    3600        86.227545   0.008296    0.226919    30.962736  
[37m[36mINFO[0m[0m 03/26 15:48:56 | 0.835876    0.855746    0.998154    0.972724    0.111952    0.835876    0.855746    0.997868    0.970085    0.998503    0.985030    0.998092    0.963057    3800        91.017964   0.004454    0.226017    30.092287  
[37m[36mINFO[0m[0m 03/26 15:50:11 | 0.827334    0.850856    0.997060    0.968055    0.145890    0.827334    0.850856    0.997335    0.974359    0.999251    0.982036    0.994593    0.947771    4000        95.808383   0.005380    0.226498    29.915286  
[37m[36mINFO[0m[0m 03/26 15:51:29 | 0.863941    0.880196    0.999504    0.975998    0.104938    0.863941    0.880196    0.999467    0.978632    1.000000    0.985030    0.999046    0.964331    4200        100.598802  0.005302    0.230143    31.410923  
[37m[36mINFO[0m[0m 03/26 15:52:44 | 0.871263    0.897311    0.998547    0.972736    0.141743    0.871263    0.897311    0.997868    0.972222    1.000000    0.988024    0.997774    0.957962    4400        105.389222  0.001764    0.227893    29.551259  
[37m[36mINFO[0m[0m 03/26 15:53:59 | 0.879805    0.899756    0.999398    0.976835    0.111202    0.879805    0.899756    0.999467    0.976496    1.000000    0.982036    0.998728    0.971975    4600        110.179641  0.004460    0.226083    30.194665  
[37m[36mINFO[0m[0m 03/26 15:55:17 | 0.852349    0.877751    0.998831    0.975137    0.117321    0.852349    0.877751    0.998401    0.976496    1.000000    0.982036    0.998092    0.966879    4800        114.970060  0.002108    0.230305    31.155920  
[37m[36mINFO[0m[0m 03/26 15:56:33 | 0.811470    0.841076    0.996280    0.967746    0.132751    0.811470    0.841076    0.996269    0.972222    0.999251    0.973054    0.993321    0.957962    5000        119.760479  0.005839    0.226103    31.147337  
[37m[36mINFO[0m[0m 03/26 15:56:33 | Extracting features AFTER training...
[37m[36mINFO[0m[0m 03/26 15:56:36 | Feature representations saved to disk.
[37m[36mINFO[0m[0m 03/26 15:56:36 | Cumulative gradient change saved at train_output/PACS/GENIE/[0]/250326_15-13-32_resnet50_sgd/sum_cumulative_g_change.npy
[37m[36mINFO[0m[0m 03/26 15:56:37 | ---
[37m[36mINFO[0m[0m 03/26 15:56:37 | test-domain validation(oracle) = 87.980%
[37m[36mINFO[0m[0m 03/26 15:56:37 | training-domain validation(iid) = 87.187%
[37m[36mINFO[0m[0m 03/26 15:56:37 | last = 81.147%
[37m[36mINFO[0m[0m 03/26 15:56:37 | last (inD) = 96.775%
[37m[36mINFO[0m[0m 03/26 15:56:37 | training-domain validation (iid, inD) = 97.812%
[37m[36mINFO[0m[0m 03/26 15:56:38 | === Summary ===
[37m[36mINFO[0m[0m 03/26 15:56:38 | Command: /jsm0707/GENIE/train_all.py resnet50_sgd config/resnet50_sgd.yaml --algorithm GENIE --test_envs 0 --dataset PACS
[37m[36mINFO[0m[0m 03/26 15:56:38 | Unique name: 250326_15-13-32_resnet50_sgd
[37m[36mINFO[0m[0m 03/26 15:56:38 | Out path: train_output/PACS/GENIE/[0]/250326_15-13-32_resnet50_sgd
[37m[36mINFO[0m[0m 03/26 15:56:38 | Algorithm: GENIE
[37m[36mINFO[0m[0m 03/26 15:56:38 | Dataset: PACS
