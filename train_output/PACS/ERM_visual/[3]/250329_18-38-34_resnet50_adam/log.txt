[37m[36mINFO[0m[0m 03/29 18:38:34 | Command :: /jsm0707/GENIE/train_all.py resnet50_adam config/resnet50_adam.yaml --algorithm ERM_visual --test_envs 3 --dataset PACS
Environment:
	Python: 3.8.10
	PyTorch: 1.13.1+cu117
	Torchvision: 0.14.1+cu117
	CUDA: 11.7
	CUDNN: 8500
	NumPy: 1.22.4
	PIL: 9.4.0
Args:
	algorithm: ERM_visual
	attn_tune: False
	auto_lr: False
	checkpoint_freq: None
	configs: ['config/resnet50_adam.yaml']
	data_dir: data
	dataset: PACS
	debug: False
	deterministic: True
	dump_scores: False
	dump_similarities: False
	evalmode: all
	evaluate: False
	full_data: False
	holdout_fraction: 0.2
	hparams_seed: 0
	in_domain: False
	model_save: None
	mpa: False
	name: resnet50_adam
	out_dir: train_output/PACS/ERM_visual/[3]/250329_18-38-34_resnet50_adam
	out_root: train_output/PACS/ERM_visual/[3]
	prebuild_loader: False
	resume_path: checkpoints/
	seed: 0
	show: False
	small_bs: False
	steps: None
	tb_freq: 10
	test_envs: [3]
	trial_seed: 0
	unique_name: 250329_18-38-34_resnet50_adam
	warmup: False
	work_dir: .
HParams:
	data_augmentation: True
	val_augment: False
	resnet18: False
	linear_steps: -1
	resnet_dropout: 0.0
	class_balanced: False
	optimizer: adam
	freeze_bn: False
	pretrained: True
	lr: 5e-05
	batch_size: 32
	weight_decay: 0.0
	swad: False
	swad_kwargs: 
	  n_converge: 3
	  n_tolerance: 6
	  tolerance_ratio: 0.3
	test_batchsize: 128
	model: resnet50
	feat_layers: stem_block
	ld: 0.1
	lr_mult: 10.0
	attn_tune: False
	auto_lr: False
Dataset:
	[PACS] #envs=4, #classes=7
	env0: A (#2048)
	env1: C (#2344)
	env2: P (#1670)
	env3: S (#3929)

[37m[36mINFO[0m[0m 03/29 18:38:34 | n_steps = 5001
[37m[36mINFO[0m[0m 03/29 18:38:34 | checkpoint_freq = 200
[37m[36mINFO[0m[0m 03/29 18:38:34 | n_steps is updated to 5001 => 5001 for checkpointing
[37m[36mINFO[0m[0m 03/29 18:38:34 | 
[37m[36mINFO[0m[0m 03/29 18:38:34 | Testenv name escaping te_S -> te_S
[37m[36mINFO[0m[0m 03/29 18:38:34 | Test envs = [3], name = te_S
[37m[36mINFO[0m[0m 03/29 18:38:34 | Train environments: [0, 1, 2], Test environments: [3]
[37m[36mINFO[0m[0m 03/29 18:38:34 | Batch sizes for each domain: [32, 32, 32, 0] (total=96)
[37m[36mINFO[0m[0m 03/29 18:38:34 | steps-per-epoch for each domain: 51.22, 58.62, 41.75 -> min = 41.75
[37m[36mINFO[0m[0m 03/29 18:38:35 | # of params = 23522375
[37m[36mINFO[0m[0m 03/29 18:38:35 | Extracting features BEFORE training...
[37m[36mINFO[0m[0m 03/29 18:39:13 | test_in     test_out    train_in    train_out   tr_outloss  env0_in     env0_out    env1_in     env1_out    env2_in     env2_out    env3_in     env3_out    step        epoch       loss        step_time   eval_time  
[37m[36mINFO[0m[0m 03/29 18:39:13 | 0.085878    0.086624    0.343697    0.307250    1.811671    0.332520    0.305623    0.284648    0.247863    0.413922    0.368263    0.085878    0.086624    0           0.000000    1.999146    7.032991    31.197899  
[37m[36mINFO[0m[0m 03/29 18:40:44 | 0.686387    0.676433    0.964593    0.956909    0.130035    0.954240    0.933985    0.944030    0.948718    0.995509    0.988024    0.686387    0.676433    200         4.790419    0.243982    0.180088    33.155257  
[37m[36mINFO[0m[0m 03/29 18:42:14 | 0.659351    0.671338    0.982888    0.957354    0.128729    0.974375    0.941320    0.980277    0.963675    0.994012    0.967066    0.659351    0.671338    400         9.580838    0.069787    0.178388    33.228868  
[37m[36mINFO[0m[0m 03/29 18:43:42 | 0.674300    0.670064    0.989455    0.951203    0.190248    0.985967    0.933985    0.986141    0.961538    0.996257    0.958084    0.674300    0.670064    600         14.371257   0.050423    0.178525    31.679076  
[37m[36mINFO[0m[0m 03/29 18:45:12 | 0.753817    0.779618    0.992553    0.964320    0.128819    0.987797    0.951100    0.993603    0.965812    0.996257    0.976048    0.753817    0.779618    800         19.161677   0.031111    0.178088    32.418984  
[37m[36mINFO[0m[0m 03/29 18:46:39 | 0.684160    0.698089    0.991621    0.957133    0.142656    0.985967    0.946210    0.994136    0.955128    0.994760    0.970060    0.684160    0.698089    1000        23.952096   0.026170    0.178252    30.756665  
[37m[36mINFO[0m[0m 03/29 18:48:08 | 0.713104    0.731210    0.990034    0.962587    0.131804    0.985357    0.943765    0.987740    0.967949    0.997006    0.976048    0.713104    0.731210    1200        28.742515   0.028598    0.178935    31.557816  
[37m[36mINFO[0m[0m 03/29 18:49:36 | 0.664440    0.672611    0.981694    0.945806    0.219935    0.970714    0.924205    0.989339    0.955128    0.985030    0.958084    0.664440    0.672611    1400        33.532934   0.017457    0.178470    31.358572  
[37m[36mINFO[0m[0m 03/29 18:51:04 | 0.805025    0.805096    0.989646    0.951393    0.197523    0.987187    0.948655    0.987740    0.944444    0.994012    0.961078    0.805025    0.805096    1600        38.323353   0.024810    0.177004    31.753090  
[37m[36mINFO[0m[0m 03/29 18:52:33 | 0.703562    0.704459    0.973351    0.943307    0.224181    0.961562    0.929095    0.971215    0.933761    0.987275    0.967066    0.703562    0.704459    1800        43.113772   0.022616    0.178239    31.238403  
[37m[36mINFO[0m[0m 03/29 18:54:00 | 0.739186    0.760510    0.993816    0.955259    0.175717    0.993289    0.938875    0.990405    0.950855    0.997754    0.976048    0.739186    0.760510    2000        47.904192   0.024593    0.177786    30.733181  
[37m[36mINFO[0m[0m 03/29 18:55:28 | 0.764631    0.783439    0.996880    0.963342    0.168634    0.995119    0.941320    0.996269    0.963675    0.999251    0.985030    0.764631    0.783439    2200        52.694611   0.016569    0.177644    31.248135  
[37m[36mINFO[0m[0m 03/29 18:56:55 | 0.690204    0.699363    0.994785    0.957236    0.194922    0.992678    0.948655    0.994670    0.952991    0.997006    0.970060    0.690204    0.699363    2400        57.485030   0.013864    0.178232    30.677652  
[37m[36mINFO[0m[0m 03/29 18:58:23 | 0.760496    0.761783    0.999593    0.970898    0.108392    0.998780    0.958435    1.000000    0.972222    1.000000    0.982036    0.760496    0.761783    2600        62.275449   0.020033    0.177372    31.293341  
[37m[36mINFO[0m[0m 03/29 18:59:52 | 0.735051    0.742675    0.997384    0.962389    0.136590    0.996949    0.955990    0.995203    0.955128    1.000000    0.976048    0.735051    0.742675    2800        67.065868   0.012770    0.177731    31.765026  
[37m[36mINFO[0m[0m 03/29 19:01:19 | 0.756043    0.745223    0.996278    0.962853    0.154507    0.992678    0.953545    0.998401    0.967949    0.997754    0.967066    0.756043    0.745223    3000        71.856287   0.011592    0.178008    30.858629  
[37m[36mINFO[0m[0m 03/29 19:02:48 | 0.752226    0.741401    0.994063    0.962793    0.139704    0.989018    0.948655    0.994670    0.963675    0.998503    0.976048    0.752226    0.741401    3200        76.646707   0.020600    0.177392    32.006683  
[37m[36mINFO[0m[0m 03/29 19:04:16 | 0.725509    0.729936    0.992105    0.945893    0.213564    0.989018    0.936430    0.992537    0.940171    0.994760    0.961078    0.725509    0.729936    3400        81.437126   0.018964    0.178573    31.118497  
[37m[36mINFO[0m[0m 03/29 19:05:46 | 0.783079    0.775796    0.996143    0.957823    0.179849    0.994509    0.938875    0.994670    0.961538    0.999251    0.973054    0.783079    0.775796    3600        86.227545   0.015165    0.179177    32.395910  
[37m[36mINFO[0m[0m 03/29 19:07:14 | 0.812977    0.826752    0.995724    0.962199    0.147787    0.993899    0.941320    0.996269    0.972222    0.997006    0.973054    0.812977    0.826752    3800        91.017964   0.016702    0.177512    31.646642  
[37m[36mINFO[0m[0m 03/29 19:08:45 | 0.736323    0.747771    0.989340    0.945527    0.214179    0.984137    0.941320    0.989872    0.940171    0.994012    0.955090    0.736323    0.747771    4000        95.808383   0.007381    0.179589    34.029654  
[37m[36mINFO[0m[0m 03/29 19:10:15 | 0.799300    0.806369    0.998226    0.968962    0.130731    0.997559    0.963325    0.997868    0.976496    0.999251    0.967066    0.799300    0.806369    4200        100.598802  0.016743    0.181066    31.988375  
[37m[36mINFO[0m[0m 03/29 19:11:42 | 0.756997    0.763057    0.995810    0.958352    0.196328    0.995119    0.941320    0.996802    0.963675    0.995509    0.970060    0.756997    0.763057    4400        105.389222  0.009395    0.178945    30.386151  
[37m[36mINFO[0m[0m 03/29 19:13:10 | 0.788804    0.793631    0.996177    0.941124    0.268722    0.994509    0.931540    0.996269    0.948718    0.997754    0.943114    0.788804    0.793631    4600        110.179641  0.015346    0.178363    31.547368  
[37m[36mINFO[0m[0m 03/29 19:14:41 | 0.694338    0.704459    0.997054    0.961775    0.155321    0.997559    0.958435    0.993603    0.965812    1.000000    0.961078    0.694338    0.704459    4800        114.970060  0.015196    0.179107    33.812286  
[37m[36mINFO[0m[0m 03/29 19:16:10 | 0.773219    0.770701    0.995716    0.958823    0.178962    0.994509    0.955990    0.994136    0.959402    0.998503    0.961078    0.773219    0.770701    5000        119.760479  0.008567    0.181562    31.074291  
[37m[36mINFO[0m[0m 03/29 19:16:31 | Extracting features AFTER training...
[37m[36mINFO[0m[0m 03/29 19:16:38 | Feature representations saved to disk.
[37m[36mINFO[0m[0m 03/29 19:16:38 | Cumulative gradient change saved at train_output/PACS/ERM_visual/[3]/250329_18-38-34_resnet50_adam/sum_cumulative_g_change.npy
[37m[36mINFO[0m[0m 03/29 19:16:39 | ---
[37m[36mINFO[0m[0m 03/29 19:16:39 | test-domain validation(oracle) = 81.298%
[37m[36mINFO[0m[0m 03/29 19:16:39 | training-domain validation(iid) = 76.050%
[37m[36mINFO[0m[0m 03/29 19:16:39 | last = 77.322%
[37m[36mINFO[0m[0m 03/29 19:16:39 | last (inD) = 95.882%
[37m[36mINFO[0m[0m 03/29 19:16:39 | training-domain validation (iid, inD) = 97.090%
[37m[36mINFO[0m[0m 03/29 19:16:39 | === Summary ===
[37m[36mINFO[0m[0m 03/29 19:16:39 | Command: /jsm0707/GENIE/train_all.py resnet50_adam config/resnet50_adam.yaml --algorithm ERM_visual --test_envs 3 --dataset PACS
[37m[36mINFO[0m[0m 03/29 19:16:39 | Unique name: 250329_18-38-34_resnet50_adam
[37m[36mINFO[0m[0m 03/29 19:16:39 | Out path: train_output/PACS/ERM_visual/[3]/250329_18-38-34_resnet50_adam
[37m[36mINFO[0m[0m 03/29 19:16:39 | Algorithm: ERM_visual
[37m[36mINFO[0m[0m 03/29 19:16:39 | Dataset: PACS
